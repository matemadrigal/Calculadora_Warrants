<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Calculadora profesional de warrants europeos con modelo Black-Scholes-Merton. An√°lisis de opciones sobre √≠ndices.">
    <meta name="keywords" content="warrant, opciones, Black-Scholes, derivados, trading, BNP Paribas">
    <meta name="author" content="Mateo Madrigal">
    
    <title>European Warrant Calculator v3.3 - Scenario Analysis</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìà</text></svg>">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        terminal: {
                            bg: '#0A0E1A',
                            panel: '#111827',
                            card: '#1F2937',
                            border: '#374151',
                            accent: '#3B82F6',
                            success: '#10B981',
                            danger: '#EF4444',
                            warning: '#F59E0B',
                            muted: '#6B7280',
                            text: '#E5E7EB'
                        }
                    },
                    fontFamily: {
                        mono: ['JetBrains Mono', 'Fira Code', 'Monaco', 'monospace']
                    }
                }
            }
        }
    </script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- PropTypes (required by Recharts) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>

    <!-- Recharts -->
    <script src="https://unpkg.com/recharts@2.5.0/umd/Recharts.js"></script>

    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        * { box-sizing: border-box; }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'JetBrains Mono', monospace;
            background: #0A0E1A;
            color: #E5E7EB;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] { -moz-appearance: textfield; }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0A0E1A; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #4B5563; }

        .transition-smooth { transition: all 0.2s ease-in-out; }
        .glow-blue { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
        .glow-green { box-shadow: 0 0 15px rgba(16, 185, 129, 0.2); }
        .glow-red { box-shadow: 0 0 15px rgba(239, 68, 68, 0.2); }

        input:focus, select:focus {
            outline: none;
            border-color: #3B82F6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        .grid-pattern {
            background-image: 
                linear-gradient(rgba(59, 130, 246, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59, 130, 246, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
        }
    </style>
</head>
<body class="grid-pattern">
    <div id="root"></div>

    <script type="text/babel">
        // ============================================================================
        // EUROPEAN WARRANT CALCULATOR v3.3 - Scenario Analysis
        // ============================================================================
        // Implementaci√≥n profesional del modelo Black-Scholes-Merton para warrants
        // europeos con an√°lisis de escenarios basado en GBM.
        //
        // v3.3: Nuevo gr√°fico de evoluci√≥n temporal con escenarios (Optimista/Normal/Pesimista)
        //       usando Geometric Brownian Motion para proyecciones consistentes.
        //
        // Autor: Mateo Madrigal
        // Licencia: MIT
        // ============================================================================

        const { useState, useMemo, useEffect, useCallback } = React;
        const { 
            LineChart, Line, XAxis, YAxis, CartesianGrid, 
            Tooltip, Legend, ResponsiveContainer, ReferenceLine, Area, AreaChart,
            ComposedChart
        } = Recharts;

        // ============================================================================
        // SECCI√ìN 1: CONSTANTES Y CONFIGURACI√ìN
        // ============================================================================

        const DAYS_PER_YEAR = 365.25;
        const NEWTON_RAPHSON_TOLERANCE = 1e-8;
        const NEWTON_RAPHSON_MAX_ITERATIONS = 100;
        const IV_BOUNDS = { min: 0.1, max: 500 };

        const COLORS = {
            primary: '#3B82F6',
            success: '#10B981',
            danger: '#EF4444',
            warning: '#F59E0B',
            muted: '#6B7280',
            text: '#E5E7EB',
            background: '#0A0E1A',
            card: '#1F2937',
            border: '#374151',
            // Colores espec√≠ficos para escenarios
            optimistic: '#22C55E',      // Verde brillante
            neutral: '#F59E0B',         // √Åmbar
            pessimistic: '#EF4444',     // Rojo
            cone: 'rgba(59, 130, 246, 0.1)' // √Årea del cono
        };

        const UNDERLYING_ASSETS = {
            EUROSTOXX50: {
                name: 'Euro Stoxx 50',
                ticker: 'SX5E',
                region: 'Europa',
                currency: 'EUR',
                spotPrice: 4950,
                dividendYield: 2.8,
                volatility: 16,
                riskFreeRate: 2.5,
                description: '50 mayores empresas de la Eurozona',
                volIndex: 'VSTOXX',
                exchange: 'EUREX'
            },
            IBEX35: {
                name: 'IBEX 35',
                ticker: 'IBEX',
                region: 'Europa',
                currency: 'EUR',
                spotPrice: 11800,
                dividendYield: 3.5,
                volatility: 18,
                riskFreeRate: 2.8,
                description: 'Principal √≠ndice burs√°til espa√±ol',
                volIndex: 'VIBEX',
                exchange: 'BME'
            },
            DAX: {
                name: 'DAX 40',
                ticker: 'DAX',
                region: 'Europa',
                currency: 'EUR',
                spotPrice: 20400,
                dividendYield: 2.5,
                volatility: 15,
                riskFreeRate: 2.5,
                description: 'Principal √≠ndice burs√°til alem√°n',
                volIndex: 'VDAX',
                exchange: 'XETRA'
            },
            CAC40: {
                name: 'CAC 40',
                ticker: 'CAC',
                region: 'Europa',
                currency: 'EUR',
                spotPrice: 7400,
                dividendYield: 2.9,
                volatility: 17,
                riskFreeRate: 2.6,
                description: 'Principal √≠ndice burs√°til franc√©s',
                volIndex: 'VCAC',
                exchange: 'EURONEXT'
            },
            FTSE100: {
                name: 'FTSE 100',
                ticker: 'UKX',
                region: 'Europa',
                currency: 'GBP',
                spotPrice: 8300,
                dividendYield: 3.8,
                volatility: 14,
                riskFreeRate: 4.2,
                description: 'Principal √≠ndice del Reino Unido',
                volIndex: 'VFTSE',
                exchange: 'LSE'
            },
            SP500: {
                name: 'S&P 500',
                ticker: 'SPX',
                region: 'EEUU',
                currency: 'USD',
                spotPrice: 6050,
                dividendYield: 1.3,
                volatility: 14,
                riskFreeRate: 4.4,
                description: '500 mayores empresas de EEUU',
                volIndex: 'VIX',
                exchange: 'CBOE'
            },
            NASDAQ100: {
                name: 'NASDAQ 100',
                ticker: 'NDX',
                region: 'EEUU',
                currency: 'USD',
                spotPrice: 21500,
                dividendYield: 0.6,
                volatility: 20,
                riskFreeRate: 4.4,
                description: '100 mayores empresas tecnol√≥gicas',
                volIndex: 'VXN',
                exchange: 'NASDAQ'
            },
            DOWJONES: {
                name: 'Dow Jones',
                ticker: 'DJI',
                region: 'EEUU',
                currency: 'USD',
                spotPrice: 44900,
                dividendYield: 1.8,
                volatility: 13,
                riskFreeRate: 4.4,
                description: '30 mayores empresas industriales',
                volIndex: 'VXD',
                exchange: 'NYSE'
            },
            NIKKEI225: {
                name: 'Nikkei 225',
                ticker: 'NKY',
                region: 'Asia',
                currency: 'JPY',
                spotPrice: 38500,
                dividendYield: 1.8,
                volatility: 18,
                riskFreeRate: 0.4,
                description: 'Principal √≠ndice japon√©s',
                volIndex: 'VXJ',
                exchange: 'TSE'
            },
            CUSTOM: {
                name: 'Personalizado',
                ticker: 'CUSTOM',
                region: 'N/A',
                currency: 'EUR',
                spotPrice: 100,
                dividendYield: 2.0,
                volatility: 20,
                riskFreeRate: 3.0,
                description: 'Introduce tus propios valores',
                volIndex: null,
                exchange: null,
                isCustom: true
            }
        };

        const ASSET_LIST = [
            { key: 'EUROSTOXX50', group: 'Europa' },
            { key: 'IBEX35', group: 'Europa' },
            { key: 'DAX', group: 'Europa' },
            { key: 'CAC40', group: 'Europa' },
            { key: 'FTSE100', group: 'Europa' },
            { key: 'SP500', group: 'EEUU' },
            { key: 'NASDAQ100', group: 'EEUU' },
            { key: 'DOWJONES', group: 'EEUU' },
            { key: 'NIKKEI225', group: 'Asia' },
            { key: 'CUSTOM', group: 'Otros' }
        ];

        // ============================================================================
        // SECCI√ìN 2: MATEM√ÅTICAS FINANCIERAS - BLACK-SCHOLES-MERTON
        // ============================================================================

        function normalCDF(x) {
            if (x < -10) return 0;
            if (x > 10) return 1;

            const a1 = 0.319381530;
            const a2 = -0.356563782;
            const a3 = 1.781477937;
            const a4 = -1.821255978;
            const a5 = 1.330274429;
            const p = 0.2316419;

            const absX = Math.abs(x);
            const t = 1 / (1 + p * absX);
            const t2 = t * t;
            const t3 = t2 * t;
            const t4 = t3 * t;
            const t5 = t4 * t;

            const pdf = Math.exp(-0.5 * x * x) / Math.sqrt(2 * Math.PI);
            const cdf = pdf * (a1 * t + a2 * t2 + a3 * t3 + a4 * t4 + a5 * t5);

            return x >= 0 ? 1 - cdf : cdf;
        }

        function normalPDF(x) {
            return Math.exp(-0.5 * x * x) / Math.sqrt(2 * Math.PI);
        }

        function calculateD1(S, K, T, r, q, sigma) {
            const numerator = Math.log(S / K) + (r - q + 0.5 * sigma * sigma) * T;
            const denominator = sigma * Math.sqrt(T);
            return numerator / denominator;
        }

        function calculateD2(d1, sigma, T) {
            return d1 - sigma * Math.sqrt(T);
        }

        function blackScholesPrice(params) {
            const { type, spot, strike, daysToExpiration, riskFreeRate, dividendYield, volatility } = params;

            if (!volatility || volatility <= 0) return 0;

            const T = daysToExpiration / DAYS_PER_YEAR;
            const r = riskFreeRate / 100;
            const q = dividendYield / 100;
            const sigma = volatility / 100;

            if (T <= 0) {
                return type === 'call' 
                    ? Math.max(0, spot - strike) 
                    : Math.max(0, strike - spot);
            }

            const d1 = calculateD1(spot, strike, T, r, q, sigma);
            const d2 = calculateD2(d1, sigma, T);

            const discountDiv = Math.exp(-q * T);
            const discountRf = Math.exp(-r * T);

            if (type === 'call') {
                return spot * discountDiv * normalCDF(d1) - strike * discountRf * normalCDF(d2);
            } else {
                return strike * discountRf * normalCDF(-d2) - spot * discountDiv * normalCDF(-d1);
            }
        }

        function calculateGreeks(params) {
            const { type, spot, strike, daysToExpiration, riskFreeRate, dividendYield, volatility } = params;

            if (!volatility || volatility <= 0 || daysToExpiration <= 0) {
                return {
                    delta: type === 'call' ? (spot > strike ? 1 : 0) : (spot < strike ? -1 : 0),
                    gamma: 0,
                    theta: 0,
                    vega: 0,
                    rho: 0
                };
            }

            const T = daysToExpiration / DAYS_PER_YEAR;
            const r = riskFreeRate / 100;
            const q = dividendYield / 100;
            const sigma = volatility / 100;

            const sqrtT = Math.sqrt(T);
            const d1 = calculateD1(spot, strike, T, r, q, sigma);
            const d2 = calculateD2(d1, sigma, T);
            const Nd1 = normalCDF(d1);
            const Nd2 = normalCDF(d2);
            const Nmd1 = normalCDF(-d1);
            const Nmd2 = normalCDF(-d2);
            const nd1 = normalPDF(d1);
            const discountDiv = Math.exp(-q * T);
            const discountRf = Math.exp(-r * T);

            let delta, gamma, theta, vega, rho;

            if (type === 'call') {
                delta = discountDiv * Nd1;
            } else {
                delta = -discountDiv * Nmd1;
            }

            gamma = (discountDiv * nd1) / (spot * sigma * sqrtT);

            const thetaCommon = -(spot * discountDiv * nd1 * sigma) / (2 * sqrtT);
            
            if (type === 'call') {
                theta = thetaCommon - r * strike * discountRf * Nd2 + q * spot * discountDiv * Nd1;
            } else {
                theta = thetaCommon + r * strike * discountRf * Nmd2 - q * spot * discountDiv * Nmd1;
            }
            theta = theta / DAYS_PER_YEAR;

            vega = (spot * discountDiv * nd1 * sqrtT) / 100;

            if (type === 'call') {
                rho = (strike * T * discountRf * Nd2) / 100;
            } else {
                rho = -(strike * T * discountRf * Nmd2) / 100;
            }

            return { delta, gamma, theta, vega, rho };
        }

        function calculateImpliedVolatility(params) {
            const { marketPrice, type, spot, strike, daysToExpiration, riskFreeRate, dividendYield } = params;

            if (!marketPrice || marketPrice <= 0) return null;

            const intrinsic = type === 'call' 
                ? Math.max(0, spot - strike * Math.exp(-riskFreeRate / 100 * daysToExpiration / DAYS_PER_YEAR))
                : Math.max(0, strike * Math.exp(-riskFreeRate / 100 * daysToExpiration / DAYS_PER_YEAR) - spot);
            
            if (marketPrice < intrinsic * 0.99) return null;

            let sigma = Math.sqrt(2 * Math.PI / (daysToExpiration / DAYS_PER_YEAR)) * (marketPrice / spot) * 100;
            sigma = Math.max(IV_BOUNDS.min, Math.min(IV_BOUNDS.max, sigma || 30));

            for (let i = 0; i < NEWTON_RAPHSON_MAX_ITERATIONS; i++) {
                const priceParams = { ...params, volatility: sigma };
                const theoreticalPrice = blackScholesPrice(priceParams);
                const diff = theoreticalPrice - marketPrice;

                if (Math.abs(diff) < NEWTON_RAPHSON_TOLERANCE) {
                    return sigma;
                }

                const greeks = calculateGreeks(priceParams);
                const vega = greeks.vega;

                if (Math.abs(vega) < 1e-10) {
                    sigma = diff > 0 ? sigma * 0.8 : sigma * 1.2;
                } else {
                    sigma = sigma - diff / vega;
                }

                sigma = Math.max(IV_BOUNDS.min, Math.min(IV_BOUNDS.max, sigma));
            }

            return null;
        }

        function calculateBreakeven(type, strike, premium, ratio) {
            const premiumPerUnit = premium / ratio;
            return type === 'call' 
                ? strike + premiumPerUnit 
                : strike - premiumPerUnit;
        }

        function adjustVolatilityForSkew(sigmaATM, S, K, T, type) {
            const putSkewIntensity = 2.2;
            const callSkewIntensity = 0.5;
            const smileCurvature = 0.5;
            const timeDecayExponent = 0.4;

            if (sigmaATM <= 0 || S <= 0 || K <= 0 || T <= 0) return sigmaATM;

            const logMoneyness = Math.log(S / K);
            const T_ref = 30 / DAYS_PER_YEAR;
            const timeFactor = Math.min(2.5, Math.pow(T_ref / Math.max(T, T_ref / 10), timeDecayExponent));

            let skewAdjustment;

            if (type === 'put') {
                if (logMoneyness > 0) {
                    skewAdjustment = putSkewIntensity * logMoneyness * timeFactor
                                   + smileCurvature * logMoneyness * logMoneyness;
                } else {
                    skewAdjustment = putSkewIntensity * logMoneyness * timeFactor * 0.25
                                   + smileCurvature * logMoneyness * logMoneyness * 0.4;
                }
            } else {
                if (logMoneyness < 0) {
                    skewAdjustment = -callSkewIntensity * logMoneyness * timeFactor
                                   + smileCurvature * logMoneyness * logMoneyness * 0.3;
                } else {
                    skewAdjustment = callSkewIntensity * logMoneyness * timeFactor * 0.15
                                   + smileCurvature * logMoneyness * logMoneyness * 0.2;
                }
            }

            const adjustedVol = sigmaATM * (1 + skewAdjustment);
            return Math.max(sigmaATM * 0.6, Math.min(sigmaATM * 2.5, adjustedVol));
        }

        function getMoneyness(type, spot, strike) {
            const ratio = spot / strike;
            
            if (type === 'call') {
                if (ratio > 1.02) return { status: 'ITM', color: COLORS.success, ratio };
                if (ratio < 0.98) return { status: 'OTM', color: COLORS.danger, ratio };
                return { status: 'ATM', color: COLORS.warning, ratio };
            } else {
                if (ratio < 0.98) return { status: 'ITM', color: COLORS.success, ratio };
                if (ratio > 1.02) return { status: 'OTM', color: COLORS.danger, ratio };
                return { status: 'ATM', color: COLORS.warning, ratio };
            }
        }

        // ============================================================================
        // SECCI√ìN 3: GEOMETRIC BROWNIAN MOTION - PROYECCI√ìN DE ESCENARIOS
        // ============================================================================

        /**
         * Proyecta el precio del subyacente usando Geometric Brownian Motion (GBM).
         * 
         * El modelo GBM asume:
         * S(t) = S‚ÇÄ ¬∑ exp[(Œº - œÉ¬≤/2)¬∑t + œÉ¬∑‚àöt¬∑Z]
         * 
         * Donde:
         * - S‚ÇÄ: Precio spot inicial
         * - Œº: Drift (r - q en riesgo neutral)
         * - œÉ: Volatilidad
         * - t: Tiempo en a√±os
         * - Z: N√∫mero de desviaciones est√°ndar (escenario)
         * 
         * @param {number} S0 - Precio spot inicial
         * @param {number} r - Tasa libre de riesgo (decimal)
         * @param {number} q - Dividend yield (decimal)
         * @param {number} sigma - Volatilidad (decimal)
         * @param {number} t - Tiempo transcurrido en a√±os
         * @param {number} z - N√∫mero de desviaciones est√°ndar
         * @returns {number} - Precio proyectado
         */
        function projectSpotGBM(S0, r, q, sigma, t, z) {
            if (t <= 0) return S0;
            
            // Drift bajo medida de probabilidad real (aproximaci√≥n)
            // Usamos r-q como proxy del drift esperado
            const mu = r - q;
            
            // GBM: S(t) = S‚ÇÄ ¬∑ exp[(Œº - œÉ¬≤/2)¬∑t + œÉ¬∑‚àöt¬∑Z]
            const drift = (mu - 0.5 * sigma * sigma) * t;
            const diffusion = sigma * Math.sqrt(t) * z;
            
            return S0 * Math.exp(drift + diffusion);
        }

        /**
         * Calcula el percentil correspondiente a un n√∫mero de desviaciones est√°ndar.
         * 
         * @param {number} z - N√∫mero de desviaciones est√°ndar
         * @returns {number} - Percentil (0-100)
         */
        function zToPercentile(z) {
            return normalCDF(z) * 100;
        }

        // ============================================================================
        // SECCI√ìN 4: UTILIDADES PARA GR√ÅFICOS
        // ============================================================================

        function calculateChartXRange(spot, strike, breakeven, type) {
            if (!spot || spot <= 0 || !strike || strike <= 0) {
                return { min: 0, max: 100, step: 1 };
            }

            const keyPoints = [spot, strike];
            if (breakeven && isFinite(breakeven) && breakeven > 0) {
                keyPoints.push(breakeven);
            }

            const minKey = Math.min(...keyPoints);
            const maxKey = Math.max(...keyPoints);
            const keyRange = maxKey - minKey;

            const marginPercent = 0.25;
            const minMargin = strike * 0.15;
            const margin = Math.max(keyRange * marginPercent, minMargin);

            let minPrice, maxPrice;
            
            if (type === 'put') {
                minPrice = Math.max(0, minKey - margin * 1.5);
                maxPrice = maxKey + margin;
            } else {
                minPrice = Math.max(0, minKey - margin);
                maxPrice = maxKey + margin * 1.5;
            }

            if (maxPrice <= minPrice) {
                maxPrice = minPrice + strike * 0.3;
            }

            const step = (maxPrice - minPrice) / 60;

            return { min: minPrice, max: maxPrice, step };
        }

        // ============================================================================
        // SECCI√ìN 5: VALIDACI√ìN DE INPUTS
        // ============================================================================

        const VALIDATION_RULES = {
            spot: { min: 0.01, max: 1000000, message: 'Debe ser positivo' },
            strike: { min: 0.01, max: 1000000, message: 'Debe ser positivo' },
            days: { min: 1, max: 3650, message: 'Rango: 1-3650 d√≠as' },
            riskFree: { min: -5, max: 50, message: 'Rango: -5% a 50%' },
            dividend: { min: 0, max: 30, message: 'Rango: 0-30%' },
            ratio: { min: 0.0001, max: 1000, message: 'Debe ser positivo' },
            volatility: { min: 0.5, max: 300, message: 'Rango: 0.5-300%' },
            marketPrice: { min: 0.000001, max: 1000000, message: 'Debe ser positivo' }
        };

        function parseNumber(value) {
            if (typeof value === 'number') return value;
            if (typeof value !== 'string') return NaN;
            
            let cleaned = value.trim();
            
            const hasComma = cleaned.includes(',');
            const hasDot = cleaned.includes('.');
            
            if (hasComma && hasDot) {
                const lastComma = cleaned.lastIndexOf(',');
                const lastDot = cleaned.lastIndexOf('.');
                
                if (lastComma > lastDot) {
                    cleaned = cleaned.replace(/\./g, '').replace(',', '.');
                } else {
                    cleaned = cleaned.replace(/,/g, '');
                }
            } else if (hasComma) {
                cleaned = cleaned.replace(',', '.');
            }
            
            return parseFloat(cleaned);
        }

        function validateInputs(inputs, calculationMode) {
            const errors = [];
            const { spot, strike, daysToExpiration, riskFreeRate, dividendYield, conversionRatio, volatility, marketPrice } = inputs;

            const checks = [
                { value: parseNumber(spot), field: 'spot', rules: VALIDATION_RULES.spot },
                { value: parseNumber(strike), field: 'strike', rules: VALIDATION_RULES.strike },
                { value: parseInt(daysToExpiration), field: 'days', rules: VALIDATION_RULES.days },
                { value: parseNumber(riskFreeRate), field: 'riskFree', rules: VALIDATION_RULES.riskFree },
                { value: parseNumber(dividendYield), field: 'dividend', rules: VALIDATION_RULES.dividend },
                { value: parseNumber(conversionRatio), field: 'ratio', rules: VALIDATION_RULES.ratio }
            ];

            checks.forEach(({ value, field, rules }) => {
                if (isNaN(value) || value < rules.min || value > rules.max) {
                    errors.push({ field, message: rules.message });
                }
            });

            if (calculationMode === 'volatility') {
                const vol = parseNumber(volatility);
                if (isNaN(vol) || vol < VALIDATION_RULES.volatility.min || vol > VALIDATION_RULES.volatility.max) {
                    errors.push({ field: 'volatility', message: VALIDATION_RULES.volatility.message });
                }
            } else {
                const price = parseNumber(marketPrice);
                if (isNaN(price) || price <= 0) {
                    errors.push({ field: 'marketPrice', message: VALIDATION_RULES.marketPrice.message });
                }
            }

            return errors;
        }

        // ============================================================================
        // SECCI√ìN 6: COMPONENTES DE UI
        // ============================================================================

        function NumberInput({ label, value, onChange, step, error, hint, suffix }) {
            return (
                <div className="mb-4">
                    <label className="block text-sm text-gray-400 mb-1.5">{label}</label>
                    <div className="relative">
                        <input
                            type="number"
                            value={value}
                            onChange={(e) => onChange(e.target.value)}
                            step={step || '1'}
                            className={`w-full bg-terminal-bg border rounded-lg px-3 py-2.5 text-terminal-text font-mono text-sm transition-smooth ${
                                error ? 'border-terminal-danger' : 'border-terminal-border hover:border-gray-500'
                            }`}
                        />
                        {suffix && (
                            <span className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 text-sm">
                                {suffix}
                            </span>
                        )}
                    </div>
                    {error && <p className="text-terminal-danger text-xs mt-1">{error}</p>}
                    {hint && !error && <p className="text-gray-500 text-xs mt-1">{hint}</p>}
                </div>
            );
        }

        function MetricCard({ label, value, subvalue, color, highlight }) {
            return (
                <div className={`bg-terminal-card rounded-lg border p-4 transition-smooth ${
                    highlight ? 'border-terminal-accent glow-blue' : 'border-terminal-border'
                }`}>
                    <p className="text-xs text-gray-400 mb-1 uppercase tracking-wide">{label}</p>
                    <p className={`text-xl font-bold font-mono ${color || 'text-terminal-text'}`}>
                        {value}
                    </p>
                    {subvalue && (
                        <p className="text-xs text-gray-500 mt-1 font-mono">{subvalue}</p>
                    )}
                </div>
            );
        }

        function PayoffTooltip({ active, payload, label }) {
            if (!active || !payload || !payload.length) return null;
            const data = payload[0]?.payload;
            
            return (
                <div className="bg-terminal-card border border-terminal-border rounded-lg p-3 shadow-lg">
                    <p className="text-terminal-text font-mono text-sm font-bold mb-2">
                        Spot: {typeof label === 'number' ? label.toLocaleString() : label}
                    </p>
                    <p className="text-gray-400 text-xs mb-2">
                        ({data?.priceChange >= 0 ? '+' : ''}{data?.priceChange}% vs actual)
                    </p>
                    <p className={`font-mono text-sm ${data?.payoff >= 0 ? 'text-terminal-success' : 'text-terminal-danger'}`}>
                        P&L: {data?.payoff >= 0 ? '+' : ''}{data?.payoff?.toFixed(2)} ‚Ç¨
                    </p>
                    <p className={`font-mono text-xs ${data?.payoffPercent >= 0 ? 'text-terminal-success' : 'text-terminal-danger'}`}>
                        ({data?.payoffPercent >= 0 ? '+' : ''}{data?.payoffPercent?.toFixed(1)}%)
                    </p>
                </div>
            );
        }

        function PriceEvolutionTooltip({ active, payload, label }) {
            if (!active || !payload || !payload.length) return null;
            const data = payload[0]?.payload;
            
            return (
                <div className="bg-terminal-card border border-terminal-border rounded-lg p-3 shadow-lg">
                    <p className="text-terminal-text font-mono text-sm font-bold mb-2">
                        Spot: {typeof label === 'number' ? label.toLocaleString() : label}
                    </p>
                    <p className="text-gray-400 text-xs mb-2">
                        ({data?.priceChange >= 0 ? '+' : ''}{data?.priceChange}% vs actual)
                    </p>
                    {payload.map((entry, idx) => (
                        <p key={idx} style={{ color: entry.color }} className="font-mono text-sm">
                            {entry.name}: {entry.value?.toFixed(2)} cts
                        </p>
                    ))}
                </div>
            );
        }

        /**
         * Tooltip personalizado para el gr√°fico de escenarios
         */
        function ScenarioTooltip({ active, payload, label, warrantType }) {
            if (!active || !payload || !payload.length) return null;
            const data = payload[0]?.payload;
            
            return (
                <div className="bg-terminal-card border border-terminal-border rounded-lg p-4 shadow-xl min-w-[220px]">
                    <div className="border-b border-terminal-border pb-2 mb-3">
                        <p className="text-terminal-text font-mono text-sm font-bold">
                            D√≠a {data?.day} de {data?.totalDays}
                        </p>
                        <p className="text-gray-500 text-xs">
                            {data?.daysRemaining} d√≠as hasta vencimiento
                        </p>
                    </div>
                    
                    <div className="space-y-2">
                        {/* Escenario Optimista */}
                        <div className="flex justify-between items-center">
                            <span className="text-xs" style={{ color: COLORS.optimistic }}>
                                ‚ñ≤ Optimista
                            </span>
                            <div className="text-right">
                                <span className="font-mono text-sm" style={{ color: COLORS.optimistic }}>
                                    {data?.optimistic?.toFixed(4)} ‚Ç¨
                                </span>
                                <span className="text-gray-500 text-xs ml-2">
                                    (S: {data?.spotOptimistic?.toLocaleString()})
                                </span>
                            </div>
                        </div>
                        
                        {/* Escenario Neutral */}
                        <div className="flex justify-between items-center">
                            <span className="text-xs" style={{ color: COLORS.neutral }}>
                                ‚óè Neutral
                            </span>
                            <div className="text-right">
                                <span className="font-mono text-sm" style={{ color: COLORS.neutral }}>
                                    {data?.neutral?.toFixed(4)} ‚Ç¨
                                </span>
                                <span className="text-gray-500 text-xs ml-2">
                                    (S: {data?.spotNeutral?.toLocaleString()})
                                </span>
                            </div>
                        </div>
                        
                        {/* Escenario Pesimista */}
                        <div className="flex justify-between items-center">
                            <span className="text-xs" style={{ color: COLORS.pessimistic }}>
                                ‚ñº Pesimista
                            </span>
                            <div className="text-right">
                                <span className="font-mono text-sm" style={{ color: COLORS.pessimistic }}>
                                    {data?.pessimistic?.toFixed(4)} ‚Ç¨
                                </span>
                                <span className="text-gray-500 text-xs ml-2">
                                    (S: {data?.spotPessimistic?.toLocaleString()})
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    {/* Rango de incertidumbre */}
                    <div className="mt-3 pt-2 border-t border-terminal-border">
                        <p className="text-gray-500 text-xs">
                            Rango: {((data?.optimistic / data?.pessimistic - 1) * 100).toFixed(0)}% diferencia
                        </p>
                    </div>
                </div>
            );
        }

        // ============================================================================
        // SECCI√ìN 7: COMPONENTE PRINCIPAL
        // ============================================================================

        function WarrantCalculator() {
            // Estado del componente
            const [selectedAsset, setSelectedAsset] = useState('EUROSTOXX50');
            const [autoFillEnabled, setAutoFillEnabled] = useState(true);
            const [warrantType, setWarrantType] = useState('put');
            const [spot, setSpot] = useState('4950');
            const [strike, setStrike] = useState('5000');
            const [daysToExpiration, setDaysToExpiration] = useState('30');
            const [riskFreeRate, setRiskFreeRate] = useState('2.5');
            const [dividendYield, setDividendYield] = useState('2.8');
            const [conversionRatio, setConversionRatio] = useState('0.001');
            const [calculationMode, setCalculationMode] = useState('volatility');
            const [volatility, setVolatility] = useState('16');
            const [marketPrice, setMarketPrice] = useState('');
            const [enableSkewAdjustment, setEnableSkewAdjustment] = useState(true);
            
            // Estado para configuraci√≥n de escenarios
            const [scenarioSigma, setScenarioSigma] = useState('1.0');
            const [showScenarioChart, setShowScenarioChart] = useState(true);

            const currentAsset = UNDERLYING_ASSETS[selectedAsset];

            // Auto-fill cuando cambia el activo
            useEffect(() => {
                if (autoFillEnabled && selectedAsset !== 'CUSTOM') {
                    const asset = UNDERLYING_ASSETS[selectedAsset];
                    if (asset) {
                        setSpot(String(asset.spotPrice));
                        setRiskFreeRate(String(asset.riskFreeRate));
                        setDividendYield(String(asset.dividendYield));
                        setVolatility(String(asset.volatility));
                        
                        const magnitude = Math.pow(10, Math.floor(Math.log10(asset.spotPrice)) - 1);
                        const roundedStrike = Math.round(asset.spotPrice / magnitude) * magnitude;
                        setStrike(String(roundedStrike));
                    }
                }
            }, [selectedAsset, autoFillEnabled]);

            // Validaci√≥n
            const errors = useMemo(() => {
                return validateInputs({
                    spot, strike, daysToExpiration, riskFreeRate,
                    dividendYield, conversionRatio, volatility, marketPrice
                }, calculationMode);
            }, [spot, strike, daysToExpiration, riskFreeRate, dividendYield, conversionRatio, calculationMode, volatility, marketPrice]);

            const getError = useCallback((field) => {
                const err = errors.find(e => e.field === field);
                return err ? err.message : null;
            }, [errors]);

            // C√°lculos principales
            const results = useMemo(() => {
                if (errors.length > 0) return null;

                const ratio = parseNumber(conversionRatio);
                const spotNum = parseNumber(spot);
                const strikeNum = parseNumber(strike);
                const daysNum = parseInt(daysToExpiration);

                const baseParams = {
                    type: warrantType,
                    spot: spotNum,
                    strike: strikeNum,
                    daysToExpiration: daysNum,
                    riskFreeRate: parseNumber(riskFreeRate),
                    dividendYield: parseNumber(dividendYield)
                };

                let premium, impliedVol, usedVolatility, inputVolatility;

                if (calculationMode === 'volatility') {
                    inputVolatility = parseNumber(volatility);
                    
                    if (enableSkewAdjustment) {
                        const T = daysNum / DAYS_PER_YEAR;
                        usedVolatility = adjustVolatilityForSkew(
                            inputVolatility, spotNum, strikeNum, T, warrantType
                        );
                    } else {
                        usedVolatility = inputVolatility;
                    }
                    
                    const priceParams = { ...baseParams, volatility: usedVolatility };
                    premium = blackScholesPrice(priceParams) * ratio;
                    impliedVol = null;
                } else {
                    const marketPriceNum = parseNumber(marketPrice);
                    const bsEquivalentPrice = marketPriceNum / ratio;
                    
                    const ivParams = { ...baseParams, marketPrice: bsEquivalentPrice };
                    const iv = calculateImpliedVolatility(ivParams);
                    
                    if (iv === null) return null;
                    
                    impliedVol = iv;
                    usedVolatility = iv;
                    premium = marketPriceNum;
                }

                const greekParams = { ...baseParams, volatility: usedVolatility };
                const greeks = calculateGreeks(greekParams);

                const deltaWarrant = greeks.delta * ratio;
                const gammaWarrant = greeks.gamma * ratio;
                const thetaWarrant = greeks.theta * ratio;
                const vegaWarrant = greeks.vega * ratio;
                const rhoWarrant = greeks.rho * ratio;

                const breakeven = calculateBreakeven(warrantType, strikeNum, premium, ratio);
                const moneynessInfo = getMoneyness(warrantType, spotNum, strikeNum);

                let intrinsicValue = warrantType === 'call'
                    ? Math.max(0, spotNum - strikeNum) * ratio
                    : Math.max(0, strikeNum - spotNum) * ratio;
                
                const timeValue = Math.max(0, premium - intrinsicValue);
                const profitLossAtExpiry = intrinsicValue - premium;
                const leverage = (spotNum * Math.abs(greeks.delta)) / (premium / ratio);

                return {
                    premium,
                    greeks: {
                        delta: greeks.delta,
                        gamma: greeks.gamma,
                        theta: greeks.theta,
                        vega: greeks.vega,
                        rho: greeks.rho
                    },
                    warrantGreeks: {
                        delta: deltaWarrant,
                        gamma: gammaWarrant,
                        theta: thetaWarrant,
                        vega: vegaWarrant,
                        rho: rhoWarrant
                    },
                    breakeven,
                    moneynessInfo,
                    intrinsicValue,
                    timeValue,
                    profitLossAtExpiry,
                    impliedVol,
                    usedVolatility,
                    leverage: isFinite(leverage) ? leverage : 0
                };
            }, [errors, warrantType, spot, strike, daysToExpiration, riskFreeRate, dividendYield, conversionRatio, calculationMode, volatility, marketPrice, enableSkewAdjustment]);

            // Datos para gr√°fico de payoff
            const payoffData = useMemo(() => {
                if (!results) return { data: [], numWarrants: 0, inversion: 0 };

                const strikeNum = parseNumber(strike);
                const ratio = parseNumber(conversionRatio);
                const spotNum = parseNumber(spot);
                const premium = results.premium;
                
                const xRange = calculateChartXRange(spotNum, strikeNum, results.breakeven, warrantType);

                const inversion = 100;
                const numWarrants = Math.floor(inversion / premium);

                const data = [];
                for (let price = xRange.min; price <= xRange.max; price += xRange.step) {
                    const intrinsicPerWarrant = warrantType === 'call'
                        ? Math.max(0, price - strikeNum) * ratio
                        : Math.max(0, strikeNum - price) * ratio;
                    
                    const plTotal = (intrinsicPerWarrant - premium) * numWarrants;
                    const plPercent = (plTotal / inversion) * 100;
                    
                    data.push({
                        price: parseFloat(price.toFixed(0)),
                        payoff: parseFloat(plTotal.toFixed(2)),
                        payoffPercent: parseFloat(plPercent.toFixed(1)),
                        priceChange: parseFloat((((price / spotNum) - 1) * 100).toFixed(1))
                    });
                }
                return { data, numWarrants, inversion };
            }, [results, spot, strike, warrantType, conversionRatio]);

            // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            // NUEVO: Datos para gr√°fico de escenarios temporales
            // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            const scenarioData = useMemo(() => {
                if (!results || calculationMode !== 'volatility') {
                    return { data: [], finalValues: null };
                }

                const spotNum = parseNumber(spot);
                const strikeNum = parseNumber(strike);
                const ratio = parseNumber(conversionRatio);
                const daysNum = parseInt(daysToExpiration);
                const r = parseNumber(riskFreeRate) / 100;
                const q = parseNumber(dividendYield) / 100;
                const sigma = results.usedVolatility / 100;
                const zSigma = parseNumber(scenarioSigma);

                // Determinar la direcci√≥n "optimista" seg√∫n el tipo de warrant
                // Para PUT: optimista = precio baja (z negativo)
                // Para CALL: optimista = precio sube (z positivo)
                const zOptimistic = warrantType === 'put' ? -zSigma : zSigma;
                const zPessimistic = warrantType === 'put' ? zSigma : -zSigma;

                const data = [];
                const numPoints = Math.min(daysNum, 60); // M√°ximo 60 puntos
                const dayStep = Math.max(1, Math.floor(daysNum / numPoints));

                for (let day = 0; day <= daysNum; day += dayStep) {
                    const t = day / DAYS_PER_YEAR; // Tiempo transcurrido
                    const daysRemaining = daysNum - day;
                    
                    // Proyectar spots para cada escenario
                    const spotOptimistic = projectSpotGBM(spotNum, r, q, sigma, t, zOptimistic);
                    const spotNeutral = projectSpotGBM(spotNum, r, q, sigma, t, 0);
                    const spotPessimistic = projectSpotGBM(spotNum, r, q, sigma, t, zPessimistic);

                    // Calcular precio del warrant para cada escenario
                    const calcWarrantPrice = (spotProjected) => {
                        if (daysRemaining <= 0) {
                            // Al vencimiento: valor intr√≠nseco
                            const intrinsic = warrantType === 'call'
                                ? Math.max(0, spotProjected - strikeNum)
                                : Math.max(0, strikeNum - spotProjected);
                            return intrinsic * ratio;
                        }
                        
                        const params = {
                            type: warrantType,
                            spot: spotProjected,
                            strike: strikeNum,
                            daysToExpiration: daysRemaining,
                            riskFreeRate: parseNumber(riskFreeRate),
                            dividendYield: parseNumber(dividendYield),
                            volatility: results.usedVolatility
                        };
                        return blackScholesPrice(params) * ratio;
                    };

                    const priceOptimistic = calcWarrantPrice(spotOptimistic);
                    const priceNeutral = calcWarrantPrice(spotNeutral);
                    const pricePessimistic = calcWarrantPrice(spotPessimistic);

                    data.push({
                        day,
                        totalDays: daysNum,
                        daysRemaining,
                        // Precios del warrant
                        optimistic: priceOptimistic,
                        neutral: priceNeutral,
                        pessimistic: pricePessimistic,
                        // Para √°rea sombreada
                        range: [pricePessimistic, priceOptimistic],
                        // Spots proyectados (para tooltip)
                        spotOptimistic: Math.round(spotOptimistic),
                        spotNeutral: Math.round(spotNeutral),
                        spotPessimistic: Math.round(spotPessimistic)
                    });
                }

                // Asegurar que el √∫ltimo punto sea exactamente el vencimiento
                if (data.length > 0 && data[data.length - 1].day !== daysNum) {
                    const t = daysNum / DAYS_PER_YEAR;
                    const spotOptimistic = projectSpotGBM(spotNum, r, q, sigma, t, zOptimistic);
                    const spotNeutral = projectSpotGBM(spotNum, r, q, sigma, t, 0);
                    const spotPessimistic = projectSpotGBM(spotNum, r, q, sigma, t, zPessimistic);

                    // Valores intr√≠nsecos al vencimiento
                    const intrinsicOpt = warrantType === 'call'
                        ? Math.max(0, spotOptimistic - strikeNum) * ratio
                        : Math.max(0, strikeNum - spotOptimistic) * ratio;
                    const intrinsicNeu = warrantType === 'call'
                        ? Math.max(0, spotNeutral - strikeNum) * ratio
                        : Math.max(0, strikeNum - spotNeutral) * ratio;
                    const intrinsicPes = warrantType === 'call'
                        ? Math.max(0, spotPessimistic - strikeNum) * ratio
                        : Math.max(0, strikeNum - spotPessimistic) * ratio;

                    data.push({
                        day: daysNum,
                        totalDays: daysNum,
                        daysRemaining: 0,
                        optimistic: intrinsicOpt,
                        neutral: intrinsicNeu,
                        pessimistic: intrinsicPes,
                        range: [intrinsicPes, intrinsicOpt],
                        spotOptimistic: Math.round(spotOptimistic),
                        spotNeutral: Math.round(spotNeutral),
                        spotPessimistic: Math.round(spotPessimistic)
                    });
                }

                // Valores finales para mostrar en resumen
                const finalValues = data.length > 0 ? {
                    optimistic: data[data.length - 1].optimistic,
                    neutral: data[data.length - 1].neutral,
                    pessimistic: data[data.length - 1].pessimistic,
                    spotOptimistic: data[data.length - 1].spotOptimistic,
                    spotNeutral: data[data.length - 1].spotNeutral,
                    spotPessimistic: data[data.length - 1].spotPessimistic,
                    percentileOptimistic: warrantType === 'put' 
                        ? zToPercentile(-parseNumber(scenarioSigma))
                        : zToPercentile(parseNumber(scenarioSigma)),
                    percentilePessimistic: warrantType === 'put'
                        ? zToPercentile(parseNumber(scenarioSigma))
                        : zToPercentile(-parseNumber(scenarioSigma))
                } : null;

                return { data, finalValues };
            }, [results, spot, strike, daysToExpiration, riskFreeRate, dividendYield, warrantType, conversionRatio, calculationMode, scenarioSigma]);

            // Render
            return (
                <div className="min-h-screen">
                    {/* Header */}
                    <header className="bg-terminal-panel border-b border-terminal-border px-6 py-4">
                        <div className="max-w-7xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 className="text-xl font-bold text-terminal-text tracking-tight">
                                    European Warrant Calculator
                                </h1>
                                <p className="text-xs text-gray-500 mt-0.5">
                                    Black-Scholes-Merton ¬∑ Greeks ¬∑ Scenario Analysis
                                </p>
                            </div>
                            <div className="flex items-center gap-4">
                                <span className="text-xs text-gray-600">
                                    {new Date().toLocaleDateString('es-ES')}
                                </span>
                                <span className="px-2 py-1 bg-terminal-accent/20 text-terminal-accent text-xs font-mono rounded">
                                    v3.3
                                </span>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-4 py-6">
                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                            
                            {/* Panel de Inputs */}
                            <div className="lg:col-span-4">
                                <div className="bg-terminal-panel rounded-xl border border-terminal-border p-5 sticky top-6">
                                    
                                    {/* Selector de Activo */}
                                    <div className="mb-6 p-4 bg-terminal-bg rounded-lg border border-terminal-accent/50">
                                        <div className="flex justify-between items-center mb-3">
                                            <span className="text-sm font-semibold text-terminal-accent">
                                                Subyacente
                                            </span>
                                            <label className="flex items-center text-xs text-gray-500 cursor-pointer hover:text-gray-400">
                                                <input
                                                    type="checkbox"
                                                    checked={autoFillEnabled}
                                                    onChange={(e) => setAutoFillEnabled(e.target.checked)}
                                                    className="mr-2 w-3.5 h-3.5 accent-terminal-accent"
                                                />
                                                Auto-fill
                                            </label>
                                        </div>
                                        
                                        <select
                                            value={selectedAsset}
                                            onChange={(e) => setSelectedAsset(e.target.value)}
                                            className="w-full bg-terminal-card border border-terminal-border rounded-lg px-3 py-2.5 text-terminal-text text-sm focus:border-terminal-accent transition-smooth"
                                        >
                                            {ASSET_LIST.map(item => (
                                                <option key={item.key} value={item.key}>
                                                    {UNDERLYING_ASSETS[item.key].name} ({UNDERLYING_ASSETS[item.key].ticker})
                                                </option>
                                            ))}
                                        </select>

                                        {currentAsset && !currentAsset.isCustom && (
                                            <div className="mt-3 flex flex-wrap gap-1.5">
                                                <span className="px-2 py-0.5 bg-terminal-card text-gray-400 text-xs rounded">
                                                    {currentAsset.currency}
                                                </span>
                                                <span className="px-2 py-0.5 bg-terminal-card text-gray-400 text-xs rounded">
                                                    {currentAsset.exchange}
                                                </span>
                                                {currentAsset.volIndex && (
                                                    <span className="px-2 py-0.5 bg-terminal-accent/20 text-terminal-accent text-xs rounded">
                                                        {currentAsset.volIndex}
                                                    </span>
                                                )}
                                            </div>
                                        )}
                                    </div>

                                    {/* Tipo Call/Put */}
                                    <div className="mb-6">
                                        <label className="block text-sm text-gray-400 mb-2">Tipo</label>
                                        <div className="grid grid-cols-2 gap-2">
                                            <button
                                                onClick={() => setWarrantType('call')}
                                                className={`py-2.5 rounded-lg font-semibold text-sm transition-smooth ${
                                                    warrantType === 'call'
                                                        ? 'bg-terminal-success text-white glow-green'
                                                        : 'bg-terminal-card text-gray-400 hover:bg-gray-700'
                                                }`}
                                            >
                                                CALL ‚ñ≤
                                            </button>
                                            <button
                                                onClick={() => setWarrantType('put')}
                                                className={`py-2.5 rounded-lg font-semibold text-sm transition-smooth ${
                                                    warrantType === 'put'
                                                        ? 'bg-terminal-danger text-white glow-red'
                                                        : 'bg-terminal-card text-gray-400 hover:bg-gray-700'
                                                }`}
                                            >
                                                PUT ‚ñº
                                            </button>
                                        </div>
                                    </div>

                                    {/* Inputs principales */}
                                    <div className="space-y-1">
                                        <NumberInput
                                            label="Spot Price (S)"
                                            value={spot}
                                            onChange={setSpot}
                                            step="0.01"
                                            error={getError('spot')}
                                        />

                                        <NumberInput
                                            label="Strike Price (K)"
                                            value={strike}
                                            onChange={setStrike}
                                            step="0.01"
                                            error={getError('strike')}
                                        />

                                        <NumberInput
                                            label="Days to Expiration"
                                            value={daysToExpiration}
                                            onChange={setDaysToExpiration}
                                            step="1"
                                            error={getError('days')}
                                        />

                                        <div className="grid grid-cols-2 gap-3">
                                            <NumberInput
                                                label="Risk-Free Rate"
                                                value={riskFreeRate}
                                                onChange={setRiskFreeRate}
                                                step="0.1"
                                                suffix="%"
                                                error={getError('riskFree')}
                                            />
                                            <NumberInput
                                                label="Dividend Yield"
                                                value={dividendYield}
                                                onChange={setDividendYield}
                                                step="0.1"
                                                suffix="%"
                                                error={getError('dividend')}
                                            />
                                        </div>

                                        <NumberInput
                                            label="Conversion Ratio"
                                            value={conversionRatio}
                                            onChange={setConversionRatio}
                                            step="0.001"
                                            hint="BNP t√≠pico: 0.001 o 0.01"
                                            error={getError('ratio')}
                                        />
                                    </div>

                                    {/* Modo de c√°lculo */}
                                    <div className="mt-6 pt-5 border-t border-terminal-border">
                                        <label className="block text-sm text-gray-400 mb-2">Modo de C√°lculo</label>
                                        <select
                                            value={calculationMode}
                                            onChange={(e) => setCalculationMode(e.target.value)}
                                            className="w-full bg-terminal-bg border border-terminal-border rounded-lg px-3 py-2.5 text-terminal-text text-sm mb-4"
                                        >
                                            <option value="volatility">œÉ ‚Üí Precio te√≥rico</option>
                                            <option value="impliedVol">Precio ‚Üí IV</option>
                                        </select>

                                        {calculationMode === 'volatility' ? (
                                            <>
                                                <NumberInput
                                                    label="Volatilidad (œÉ)"
                                                    value={volatility}
                                                    onChange={setVolatility}
                                                    step="0.5"
                                                    suffix="%"
                                                    error={getError('volatility')}
                                                />
                                                
                                                <div className="mt-3 p-3 bg-terminal-bg rounded-lg border border-terminal-border">
                                                    <div className="flex items-center justify-between">
                                                        <label className="flex items-center cursor-pointer">
                                                            <input
                                                                type="checkbox"
                                                                checked={enableSkewAdjustment}
                                                                onChange={(e) => setEnableSkewAdjustment(e.target.checked)}
                                                                className="mr-2 w-4 h-4 accent-terminal-warning"
                                                            />
                                                            <span className="text-sm text-terminal-text">
                                                                Volatility Skew
                                                            </span>
                                                        </label>
                                                        {enableSkewAdjustment && results && (
                                                            <span className="text-sm text-terminal-warning font-mono">
                                                                œÉ: {results.usedVolatility.toFixed(1)}%
                                                            </span>
                                                        )}
                                                    </div>
                                                    <p className="text-xs text-gray-500 mt-1">
                                                        Ajusta œÉ seg√∫n moneyness (OTM ‚Üí mayor IV)
                                                    </p>
                                                </div>
                                            </>
                                        ) : (
                                            <NumberInput
                                                label="Precio de Mercado"
                                                value={marketPrice}
                                                onChange={setMarketPrice}
                                                step="0.0001"
                                                suffix="EUR"
                                                error={getError('marketPrice')}
                                            />
                                        )}
                                    </div>

                                    {/* Configuraci√≥n de escenarios */}
                                    {calculationMode === 'volatility' && (
                                        <div className="mt-4 p-4 bg-gradient-to-br from-terminal-bg to-terminal-card rounded-lg border border-terminal-accent/30">
                                            <div className="flex items-center justify-between mb-3">
                                                <span className="text-sm font-semibold text-terminal-accent flex items-center gap-2">
                                                    <span>üìä</span> An√°lisis de Escenarios
                                                </span>
                                                <label className="flex items-center cursor-pointer">
                                                    <input
                                                        type="checkbox"
                                                        checked={showScenarioChart}
                                                        onChange={(e) => setShowScenarioChart(e.target.checked)}
                                                        className="mr-2 w-4 h-4 accent-terminal-accent"
                                                    />
                                                    <span className="text-xs text-gray-400">Mostrar</span>
                                                </label>
                                            </div>
                                            
                                            <div className="mb-3">
                                                <label className="block text-xs text-gray-400 mb-1.5">
                                                    Desviaciones est√°ndar (œÉ)
                                                </label>
                                                <div className="grid grid-cols-4 gap-1.5">
                                                    {['0.5', '1.0', '1.5', '2.0'].map(val => (
                                                        <button
                                                            key={val}
                                                            onClick={() => setScenarioSigma(val)}
                                                            className={`py-1.5 rounded text-xs font-mono transition-smooth ${
                                                                scenarioSigma === val
                                                                    ? 'bg-terminal-accent text-white'
                                                                    : 'bg-terminal-card text-gray-400 hover:bg-gray-700'
                                                            }`}
                                                        >
                                                            ¬±{val}œÉ
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                            
                                            <p className="text-xs text-gray-500">
                                                GBM: S(t) = S‚ÇÄ¬∑e<sup>(Œº-œÉ¬≤/2)t + œÉ‚àöt¬∑Z</sup>
                                            </p>
                                        </div>
                                    )}

                                    <p className="text-xs text-gray-600 mt-4 p-3 bg-terminal-bg rounded-lg">
                                        ‚ö†Ô∏è Datos orientativos. Verificar antes de operar.
                                    </p>
                                </div>
                            </div>

                            {/* Panel de Resultados */}
                            <div className="lg:col-span-8 space-y-6">
                                {results ? (
                                    <>
                                        {/* M√©tricas principales */}
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                                            <MetricCard
                                                label="Premium"
                                                value={`${results.premium.toFixed(4)} ‚Ç¨`}
                                                subvalue={`TV: ${results.timeValue.toFixed(4)}`}
                                                color="text-terminal-accent"
                                                highlight={true}
                                            />
                                            <MetricCard
                                                label="Delta (Œî)"
                                                value={results.greeks.delta.toFixed(4)}
                                                subvalue={`Warrant: ${results.warrantGreeks.delta.toFixed(6)}`}
                                                color={results.greeks.delta >= 0 ? 'text-terminal-success' : 'text-terminal-danger'}
                                            />
                                            <MetricCard
                                                label="Breakeven"
                                                value={results.breakeven.toFixed(2)}
                                                subvalue={`S/K: ${results.moneynessInfo.ratio.toFixed(4)}`}
                                            />
                                            <MetricCard
                                                label="P&L @ Expiry"
                                                value={`${results.profitLossAtExpiry >= 0 ? '+' : ''}${results.profitLossAtExpiry.toFixed(4)} ‚Ç¨`}
                                                subvalue={`si Spot = ${spot}`}
                                                color={results.profitLossAtExpiry >= 0 ? 'text-terminal-success' : 'text-terminal-danger'}
                                            />
                                        </div>

                                        {/* Greeks completas */}
                                        <div className="bg-terminal-panel rounded-xl border border-terminal-border p-5">
                                            <h3 className="text-sm font-semibold text-terminal-text mb-4 flex items-center gap-2">
                                                <span className="w-2 h-2 bg-terminal-accent rounded-full"></span>
                                                Greeks Analysis
                                            </h3>
                                            <div className="grid grid-cols-5 gap-3">
                                                <div className="text-center p-3 bg-terminal-bg rounded-lg">
                                                    <p className="text-xs text-gray-500 mb-1">Delta (Œî)</p>
                                                    <p className="text-lg font-mono font-bold text-terminal-text">
                                                        {results.greeks.delta.toFixed(4)}
                                                    </p>
                                                    <p className="text-xs text-gray-600 mt-1">‚àÇV/‚àÇS</p>
                                                </div>
                                                <div className="text-center p-3 bg-terminal-bg rounded-lg">
                                                    <p className="text-xs text-gray-500 mb-1">Gamma (Œì)</p>
                                                    <p className="text-lg font-mono font-bold text-terminal-text">
                                                        {results.greeks.gamma.toFixed(6)}
                                                    </p>
                                                    <p className="text-xs text-gray-600 mt-1">‚àÇ¬≤V/‚àÇS¬≤</p>
                                                </div>
                                                <div className="text-center p-3 bg-terminal-bg rounded-lg">
                                                    <p className="text-xs text-gray-500 mb-1">Theta (Œò)</p>
                                                    <p className="text-lg font-mono font-bold text-terminal-danger">
                                                        {results.greeks.theta.toFixed(4)}
                                                    </p>
                                                    <p className="text-xs text-gray-600 mt-1">‚Ç¨/d√≠a</p>
                                                </div>
                                                <div className="text-center p-3 bg-terminal-bg rounded-lg">
                                                    <p className="text-xs text-gray-500 mb-1">Vega (ŒΩ)</p>
                                                    <p className="text-lg font-mono font-bold text-terminal-text">
                                                        {results.greeks.vega.toFixed(4)}
                                                    </p>
                                                    <p className="text-xs text-gray-600 mt-1">‚Ç¨/1% œÉ</p>
                                                </div>
                                                <div className="text-center p-3 bg-terminal-bg rounded-lg">
                                                    <p className="text-xs text-gray-500 mb-1">Rho (œÅ)</p>
                                                    <p className="text-lg font-mono font-bold text-terminal-text">
                                                        {results.greeks.rho.toFixed(4)}
                                                    </p>
                                                    <p className="text-xs text-gray-600 mt-1">‚Ç¨/1% r</p>
                                                </div>
                                            </div>

                                            <div className="mt-4 pt-4 border-t border-terminal-border grid grid-cols-3 gap-4 text-center">
                                                <div>
                                                    <p className="text-xs text-gray-500">Moneyness</p>
                                                    <p className="font-bold" style={{ color: results.moneynessInfo.color }}>
                                                        {results.moneynessInfo.status}
                                                    </p>
                                                </div>
                                                <div>
                                                    <p className="text-xs text-gray-500">Apalancamiento</p>
                                                    <p className="font-bold text-terminal-text">
                                                        {results.leverage.toFixed(1)}x
                                                    </p>
                                                </div>
                                                <div>
                                                    <p className="text-xs text-gray-500">
                                                        {results.impliedVol !== null ? 'Implied Vol' : 'Volatilidad'}
                                                    </p>
                                                    <p className="font-bold text-terminal-accent">
                                                        {results.usedVolatility.toFixed(2)}%
                                                    </p>
                                                </div>
                                            </div>
                                        </div>

                                        {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                                        {/* NUEVO: Gr√°fico de Escenarios Temporales */}
                                        {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                                        {showScenarioChart && calculationMode === 'volatility' && scenarioData.data.length > 0 && (
                                            <div className="bg-terminal-panel rounded-xl border border-terminal-accent/50 p-5">
                                                <div className="flex justify-between items-start mb-4">
                                                    <div>
                                                        <h3 className="text-sm font-semibold text-terminal-text flex items-center gap-2">
                                                            <span className="w-2 h-2 bg-terminal-accent rounded-full animate-pulse"></span>
                                                            Proyecci√≥n Temporal por Escenarios
                                                        </h3>
                                                        <p className="text-xs text-gray-500 mt-1">
                                                            Evoluci√≥n del precio del warrant seg√∫n movimiento del subyacente (GBM ¬±{scenarioSigma}œÉ)
                                                        </p>
                                                    </div>
                                                    <div className="text-right">
                                                        <div className="flex items-center gap-3 text-xs">
                                                            <span className="flex items-center gap-1">
                                                                <span className="w-3 h-0.5" style={{ backgroundColor: COLORS.optimistic }}></span>
                                                                Optimista
                                                            </span>
                                                            <span className="flex items-center gap-1">
                                                                <span className="w-3 h-0.5" style={{ backgroundColor: COLORS.neutral }}></span>
                                                                Neutral
                                                            </span>
                                                            <span className="flex items-center gap-1">
                                                                <span className="w-3 h-0.5" style={{ backgroundColor: COLORS.pessimistic }}></span>
                                                                Pesimista
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Resumen de valores al vencimiento */}
                                                {scenarioData.finalValues && (
                                                    <div className="grid grid-cols-3 gap-3 mb-4">
                                                        <div className="bg-terminal-bg rounded-lg p-3 border-l-2" style={{ borderColor: COLORS.optimistic }}>
                                                            <p className="text-xs text-gray-500 mb-1">
                                                                Optimista (p{scenarioData.finalValues.percentileOptimistic.toFixed(0)})
                                                            </p>
                                                            <p className="font-mono font-bold" style={{ color: COLORS.optimistic }}>
                                                                {scenarioData.finalValues.optimistic.toFixed(4)} ‚Ç¨
                                                            </p>
                                                            <p className="text-xs text-gray-600">
                                                                Spot ‚Üí {scenarioData.finalValues.spotOptimistic.toLocaleString()}
                                                            </p>
                                                        </div>
                                                        <div className="bg-terminal-bg rounded-lg p-3 border-l-2" style={{ borderColor: COLORS.neutral }}>
                                                            <p className="text-xs text-gray-500 mb-1">
                                                                Neutral (p50)
                                                            </p>
                                                            <p className="font-mono font-bold" style={{ color: COLORS.neutral }}>
                                                                {scenarioData.finalValues.neutral.toFixed(4)} ‚Ç¨
                                                            </p>
                                                            <p className="text-xs text-gray-600">
                                                                Spot ‚Üí {scenarioData.finalValues.spotNeutral.toLocaleString()}
                                                            </p>
                                                        </div>
                                                        <div className="bg-terminal-bg rounded-lg p-3 border-l-2" style={{ borderColor: COLORS.pessimistic }}>
                                                            <p className="text-xs text-gray-500 mb-1">
                                                                Pesimista (p{scenarioData.finalValues.percentilePessimistic.toFixed(0)})
                                                            </p>
                                                            <p className="font-mono font-bold" style={{ color: COLORS.pessimistic }}>
                                                                {scenarioData.finalValues.pessimistic.toFixed(4)} ‚Ç¨
                                                            </p>
                                                            <p className="text-xs text-gray-600">
                                                                Spot ‚Üí {scenarioData.finalValues.spotPessimistic.toLocaleString()}
                                                            </p>
                                                        </div>
                                                    </div>
                                                )}

                                                <ResponsiveContainer width="100%" height={320}>
                                                    <ComposedChart data={scenarioData.data}>
                                                        <defs>
                                                            <linearGradient id="coneGradient" x1="0" y1="0" x2="0" y2="1">
                                                                <stop offset="5%" stopColor={COLORS.primary} stopOpacity={0.15}/>
                                                                <stop offset="95%" stopColor={COLORS.primary} stopOpacity={0.02}/>
                                                            </linearGradient>
                                                        </defs>
                                                        <CartesianGrid strokeDasharray="3 3" stroke={COLORS.border} />
                                                        <XAxis 
                                                            dataKey="day" 
                                                            stroke={COLORS.muted} 
                                                            tick={{ fill: COLORS.muted, fontSize: 11 }}
                                                            tickFormatter={(v) => `D${v}`}
                                                            label={{ 
                                                                value: 'D√≠as transcurridos', 
                                                                position: 'insideBottom', 
                                                                offset: -5,
                                                                fill: COLORS.muted, 
                                                                fontSize: 10 
                                                            }}
                                                        />
                                                        <YAxis 
                                                            stroke={COLORS.muted} 
                                                            tick={{ fill: COLORS.muted, fontSize: 11 }}
                                                            tickFormatter={(v) => `${v.toFixed(3)}`}
                                                            label={{ 
                                                                value: 'Precio Warrant (‚Ç¨)', 
                                                                angle: -90, 
                                                                position: 'insideLeft', 
                                                                fill: COLORS.muted, 
                                                                fontSize: 10 
                                                            }}
                                                            domain={['auto', 'auto']}
                                                        />
                                                        <Tooltip content={<ScenarioTooltip warrantType={warrantType} />} />
                                                        
                                                        {/* √Årea del cono de incertidumbre */}
                                                        <Area
                                                            type="monotone"
                                                            dataKey="range"
                                                            fill="url(#coneGradient)"
                                                            stroke="none"
                                                        />
                                                        
                                                        {/* L√≠nea de precio actual */}
                                                        <ReferenceLine 
                                                            y={results.premium} 
                                                            stroke={COLORS.text} 
                                                            strokeDasharray="5 5"
                                                            label={{ 
                                                                value: `Precio actual: ${results.premium.toFixed(4)}‚Ç¨`, 
                                                                fill: COLORS.text, 
                                                                fontSize: 9, 
                                                                position: 'right' 
                                                            }}
                                                        />
                                                        
                                                        {/* L√≠nea optimista */}
                                                        <Line 
                                                            type="monotone" 
                                                            dataKey="optimistic" 
                                                            name="Optimista"
                                                            stroke={COLORS.optimistic} 
                                                            strokeWidth={2.5} 
                                                            dot={false}
                                                            activeDot={{ r: 4, fill: COLORS.optimistic }}
                                                        />
                                                        
                                                        {/* L√≠nea neutral */}
                                                        <Line 
                                                            type="monotone" 
                                                            dataKey="neutral" 
                                                            name="Neutral"
                                                            stroke={COLORS.neutral} 
                                                            strokeWidth={2.5} 
                                                            dot={false}
                                                            activeDot={{ r: 4, fill: COLORS.neutral }}
                                                        />
                                                        
                                                        {/* L√≠nea pesimista */}
                                                        <Line 
                                                            type="monotone" 
                                                            dataKey="pessimistic" 
                                                            name="Pesimista"
                                                            stroke={COLORS.pessimistic} 
                                                            strokeWidth={2.5} 
                                                            dot={false}
                                                            activeDot={{ r: 4, fill: COLORS.pessimistic }}
                                                        />
                                                    </ComposedChart>
                                                </ResponsiveContainer>

                                                <div className="mt-4 pt-3 border-t border-terminal-border">
                                                    <div className="flex justify-between items-center text-xs text-gray-500">
                                                        <p>
                                                            üìê Modelo: Geometric Brownian Motion ¬∑ 
                                                            œÉ = {results.usedVolatility.toFixed(1)}% ¬∑ 
                                                            r = {riskFreeRate}% ¬∑ 
                                                            q = {dividendYield}%
                                                        </p>
                                                        <p>
                                                            {warrantType === 'put' 
                                                                ? 'üêª PUT: Optimista = Spot ‚Üì' 
                                                                : 'üêÇ CALL: Optimista = Spot ‚Üë'}
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Gr√°fico de Payoff */}
                                        <div className="bg-terminal-panel rounded-xl border border-terminal-border p-5">
                                            <div className="flex justify-between items-start mb-4">
                                                <div>
                                                    <h3 className="text-sm font-semibold text-terminal-text flex items-center gap-2">
                                                        <span className="w-2 h-2 bg-terminal-success rounded-full"></span>
                                                        P&L al Vencimiento
                                                    </h3>
                                                    <p className="text-xs text-gray-500 mt-1">
                                                        Simulaci√≥n con {payoffData.numWarrants} warrants ({payoffData.inversion}‚Ç¨ invertidos)
                                                    </p>
                                                </div>
                                                <div className="text-right text-xs text-gray-500">
                                                    <p>Eje X: Precio spot</p>
                                                    <p>Eje Y: Ganancia/P√©rdida (‚Ç¨)</p>
                                                </div>
                                            </div>
                                            <ResponsiveContainer width="100%" height={280}>
                                                <AreaChart data={payoffData.data}>
                                                    <defs>
                                                        <linearGradient id="payoffGradient" x1="0" y1="0" x2="0" y2="1">
                                                            <stop offset="5%" stopColor={warrantType === 'call' ? COLORS.success : COLORS.danger} stopOpacity={0.3}/>
                                                            <stop offset="95%" stopColor={warrantType === 'call' ? COLORS.success : COLORS.danger} stopOpacity={0}/>
                                                        </linearGradient>
                                                    </defs>
                                                    <CartesianGrid strokeDasharray="3 3" stroke={COLORS.border} />
                                                    <XAxis 
                                                        dataKey="price" 
                                                        stroke={COLORS.muted} 
                                                        tick={{ fill: COLORS.muted, fontSize: 11 }}
                                                        tickFormatter={(v) => v.toLocaleString()}
                                                    />
                                                    <YAxis 
                                                        stroke={COLORS.muted} 
                                                        tick={{ fill: COLORS.muted, fontSize: 11 }}
                                                        tickFormatter={(v) => `${v >= 0 ? '+' : ''}${v.toFixed(0)}‚Ç¨`}
                                                    />
                                                    <Tooltip content={<PayoffTooltip />} />
                                                    <ReferenceLine y={0} stroke={COLORS.text} strokeWidth={1} />
                                                    <ReferenceLine 
                                                        x={parseNumber(strike)} 
                                                        stroke={COLORS.muted} 
                                                        strokeDasharray="5 5" 
                                                        label={{ value: `K=${parseNumber(strike).toLocaleString()}`, fill: COLORS.muted, fontSize: 9, position: 'top' }} 
                                                    />
                                                    <ReferenceLine 
                                                        x={results.breakeven} 
                                                        stroke={COLORS.warning} 
                                                        strokeDasharray="5 5" 
                                                        label={{ value: `BE=${results.breakeven.toLocaleString(undefined, {maximumFractionDigits: 0})}`, fill: COLORS.warning, fontSize: 9, position: 'top' }} 
                                                    />
                                                    <ReferenceLine 
                                                        x={parseNumber(spot)} 
                                                        stroke={COLORS.primary} 
                                                        strokeDasharray="3 3" 
                                                        label={{ value: 'Spot', fill: COLORS.primary, fontSize: 9, position: 'bottom' }} 
                                                    />
                                                    <Area 
                                                        type="monotone" 
                                                        dataKey="payoff" 
                                                        name="P&L"
                                                        stroke={warrantType === 'call' ? COLORS.success : COLORS.danger} 
                                                        strokeWidth={2}
                                                        fill="url(#payoffGradient)"
                                                    />
                                                </AreaChart>
                                            </ResponsiveContainer>
                                            <p className="text-xs text-gray-600 mt-3 text-center">
                                                üìç Strike (K) = {parseNumber(strike).toLocaleString()} | üéØ Breakeven = {results.breakeven.toLocaleString(undefined, {maximumFractionDigits: 0})} | 
                                                {warrantType === 'put' ? ' Ganas si el √≠ndice BAJA' : ' Ganas si el √≠ndice SUBE'}
                                            </p>
                                        </div>
                                    </>
                                ) : (
                                    <div className="bg-terminal-panel rounded-xl border border-terminal-danger/50 p-8 text-center">
                                        <div className="text-terminal-danger text-4xl mb-3">‚ö†</div>
                                        <p className="text-terminal-danger font-semibold">
                                            {errors.length > 0 ? 'Corrige los errores de validaci√≥n' : 'No se pudo calcular la IV'}
                                        </p>
                                        {errors.length > 0 && (
                                            <ul className="mt-3 text-sm text-gray-400">
                                                {errors.map((e, i) => (
                                                    <li key={i}>{e.field}: {e.message}</li>
                                                ))}
                                            </ul>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>
                    </main>

                    {/* Footer */}
                    <footer className="bg-terminal-panel border-t border-terminal-border px-6 py-4 mt-12">
                        <div className="max-w-7xl mx-auto flex justify-between items-center text-xs text-gray-600">
                            <p>European Warrant Calculator v3.3 ¬∑ Black-Scholes-Merton + GBM Scenarios</p>
                            <p>Solo para fines educativos ¬∑ No es asesoramiento financiero</p>
                        </div>
                    </footer>
                </div>
            );
        }

        // Punto de entrada
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(WarrantCalculator));
    </script>
</body>
</html>
